{% comment %}
  Product page template
{% endcomment %}

<div class="section" style="min-height: calc(100vh - 200px);">
  <div class="container">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; margin-bottom: 6rem;">

      <div class="product-media">
        {%- if product.images.size > 0 -%}
          <div id="product-main-image" style="margin-bottom: 1.5rem;">
            <img
              src="{{ product.featured_image | image_url: width: 1000 }}"
              alt="{{ product.title }}"
              style="width: 100%; border-radius: 8px;"
              id="main-product-image"
            >
          </div>

          {%- if product.images.size > 1 -%}
            <div style="display: flex; gap: 1rem; overflow-x: auto;">
              {%- for image in product.images -%}
                <img
                  src="{{ image | image_url: width: 150 }}"
                  alt="{{ product.title }}"
                  style="width: 100px; height: 100px; object-fit: cover; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                  onclick="document.getElementById('main-product-image').src = '{{ image | image_url: width: 1000 }}'"
                  class="product-thumbnail"
                >
              {%- endfor -%}
            </div>
          {%- endif -%}
        {%- else -%}
          <div style="width: 100%; padding-top: 100%; background-color: rgba(255, 255, 255, 0.1); border-radius: 8px;"></div>
        {%- endif -%}
      </div>

      <div class="product-details">
        <h1 style="margin-bottom: 1rem;">{{ product.title }}</h1>

        {%- if product.vendor != blank -%}
          <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1.5rem;">{{ product.vendor }}</p>
        {%- endif -%}

        <div style="font-size: 2rem; font-weight: 600; margin-bottom: 2rem; color: var(--color-warm-offwhite);">
          {%- if product.compare_at_price > product.price -%}
            <span style="text-decoration: line-through; opacity: 0.6; font-size: 1.5rem; margin-right: 1rem;">
              {{ product.compare_at_price | money }}
            </span>
          {%- endif -%}
          {{ product.price | money }}
        </div>

        {% form 'product', product %}
          {%- if product.variants.size > 1 -%}
            <div style="margin-bottom: 2rem;">
              <label style="display: block; margin-bottom: 0.8rem; font-weight: 500;">Select Variant</label>
              <select
                name="id"
                style="
                  width: 100%;
                  padding: 1rem 1.5rem;
                  background-color: rgba(255, 255, 255, 0.1);
                  border: 1px solid rgba(255, 255, 255, 0.2);
                  border-radius: 4px;
                  color: #FFFFFF;
                  font-size: 1rem;
                "
              >
                {%- for variant in product.variants -%}
                  <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %}>
                    {{ variant.title }} - {{ variant.price | money }}
                    {%- unless variant.available %} (Sold Out){% endunless -%}
                  </option>
                {%- endfor -%}
              </select>
            </div>
          {%- else -%}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {%- endif -%}

          <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 2rem;">
            <label style="font-weight: 500;">Quantity</label>
            <input
              type="number"
              name="quantity"
              value="1"
              min="1"
              style="
                width: 80px;
                padding: 0.8rem;
                background-color: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 4px;
                color: #FFFFFF;
                text-align: center;
              "
            >
          </div>

          <button
            type="submit"
            class="btn"
            style="width: 100%; padding: 1.5rem; font-size: 1rem; margin-bottom: 1rem;"
            {% unless product.available %}disabled{% endunless %}
          >
            {%- if product.available -%}
              Add to Cart
            {%- else -%}
              Sold Out
            {%- endif -%}
          </button>
        {% endform %}

        {%- if product.available -%}
          <p style="color: #4CAF50; font-size: 0.9rem; margin-bottom: 2rem;">âœ“ In Stock</p>
        {%- else -%}
          <p style="color: #FF5252; font-size: 0.9rem; margin-bottom: 2rem;">Out of Stock</p>
        {%- endif -%}

        <div class="product-tabs" style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 2rem;">
          <div class="tab-buttons" style="display: flex; gap: 2rem; margin-bottom: 2rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
            <button class="tab-btn active" data-tab="description" style="padding-bottom: 1rem; font-weight: 500; background: none; border: none; color: white; border-bottom: 2px solid white;">
              Description
            </button>
            <button class="tab-btn" data-tab="shipping" style="padding-bottom: 1rem; font-weight: 500; background: none; border: none; color: rgba(255,255,255,0.6); border-bottom: 2px solid transparent;">
              Shipping & Returns
            </button>
            <button class="tab-btn" data-tab="specs" style="padding-bottom: 1rem; font-weight: 500; background: none; border: none; color: rgba(255,255,255,0.6); border-bottom: 2px solid transparent;">
              Specifications
            </button>
          </div>

          <div class="tab-content active" data-content="description">
            <div style="line-height: 1.8; color: rgba(255, 255, 255, 0.9);">
              {{ product.description }}
            </div>
          </div>

          <div class="tab-content" data-content="shipping" style="display: none;">
            <p style="line-height: 1.8; color: rgba(255, 255, 255, 0.9);">
              Free standard shipping on orders over $100. Express shipping available at checkout.
              Returns accepted within 30 days of purchase. Items must be in original condition with tags attached.
            </p>
          </div>

          <div class="tab-content" data-content="specs" style="display: none;">
            <p style="line-height: 1.8; color: rgba(255, 255, 255, 0.9);">
              {%- if product.metafields.custom.specifications != blank -%}
                {{ product.metafields.custom.specifications }}
              {%- else -%}
                Product specifications will be displayed here.
              {%- endif -%}
            </p>
          </div>
        </div>
      </div>
    </div>

    {%- if product.collections.size > 0 -%}
      {%- assign related_collection = product.collections.first -%}
      <div style="margin-top: 6rem;">
        <h2 class="section-title">Related Products</h2>
        <div class="product-grid">
          {%- for related_product in related_collection.products limit: 4 -%}
            {%- unless related_product.id == product.id -%}
              <a href="{{ related_product.url }}" class="product-card">
                <div class="product-image-wrapper">
                  {%- if related_product.featured_image != blank -%}
                    <img
                      src="{{ related_product.featured_image | image_url: width: 600 }}"
                      alt="{{ related_product.title }}"
                      class="product-image"
                      loading="lazy"
                    >
                  {%- endif -%}
                </div>
                <div class="product-info">
                  <h3 class="product-title">{{ related_product.title }}</h3>
                  <p class="product-price">{{ related_product.price | money }}</p>
                </div>
              </a>
            {%- endunless -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  @media screen and (max-width: 989px) {
    .container > div:first-child {
      grid-template-columns: 1fr !important;
    }
  }

  .product-thumbnail:hover {
    border-color: var(--color-white) !important;
  }

  .tab-btn.active {
    color: white !important;
    border-bottom-color: white !important;
  }
</style>

<script>
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.dataset.tab;

      document.querySelectorAll('.tab-btn').forEach(b => {
        b.classList.remove('active');
        b.style.color = 'rgba(255,255,255,0.6)';
        b.style.borderBottomColor = 'transparent';
      });

      document.querySelectorAll('.tab-content').forEach(c => {
        c.classList.remove('active');
        c.style.display = 'none';
      });

      btn.classList.add('active');
      btn.style.color = 'white';
      btn.style.borderBottomColor = 'white';

      const content = document.querySelector(`[data-content="${tab}"]`);
      content.classList.add('active');
      content.style.display = 'block';
    });
  });
</script>
