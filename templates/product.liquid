{% comment %}
  Product page template
{% endcomment %}

<div class="section" style="min-height: 100vh; padding-top: 2rem; padding-bottom: 2rem; display: flex; align-items: center;">
  <div class="container">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6rem; align-items: start;">

      <div class="product-media" style="position: sticky; top: 120px; align-self: flex-start;">
        {%- if product.images.size > 0 -%}
          <div id="product-main-image" style="margin-bottom: 1.5rem; background: rgba(255,255,255,0.05); border-radius: 12px; overflow: hidden; aspect-ratio: 1/1;">
            <img
              src="{{ product.featured_image | image_url: width: 1000 }}"
              alt="{{ product.title }}"
              style="width: 100%; height: 100%; object-fit: cover; display: block;"
              id="main-product-image"
            >
          </div>

          {%- if product.images.size > 1 -%}
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem;">
              {%- for image in product.images -%}
                <img
                  src="{{ image | image_url: width: 200 }}"
                  alt="{{ product.title }}"
                  style="width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; cursor: pointer; border: 3px solid transparent; background: rgba(255,255,255,0.05);"
                  onclick="selectImage(this, '{{ image | image_url: width: 1000 }}')"
                  class="product-thumbnail"
                  data-image-url="{{ image | image_url: width: 1000 }}"
                >
              {%- endfor -%}
            </div>
          {%- endif -%}
        {%- else -%}
          <div style="width: 100%; aspect-ratio: 1/1; background-color: rgba(255, 255, 255, 0.1); border-radius: 12px;"></div>
        {%- endif -%}
      </div>

      <div class="product-details">
        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
          <div style="display: flex; gap: 0.25rem;">
            <span style="color: #FFC107; font-size: 1.25rem;">★</span>
            <span style="color: #FFC107; font-size: 1.25rem;">★</span>
            <span style="color: #FFC107; font-size: 1.25rem;">★</span>
            <span style="color: #FFC107; font-size: 1.25rem;">★</span>
            <span style="color: #FFC107; font-size: 1.25rem;">★</span>
          </div>
          <span style="color: rgba(255,255,255,0.7); font-size: 0.95rem;">4.9/5 with 120+ Experts</span>
        </div>

        <h1 style="margin-bottom: 0.75rem; font-size: 2.25rem; line-height: 1.2;">{{ product.title }}</h1>

        {%- if product.vendor != blank -%}
          <p style="color: rgba(255, 255, 255, 0.6); margin-bottom: 2.5rem; font-size: 0.95rem;">{{ product.vendor }}</p>
        {%- endif -%}

        <div style="margin-bottom: 2.5rem;">
          <span style="font-size: 2.5rem; font-weight: 700; color: var(--color-warm-offwhite);">
            {{ product.price | money }}
          </span>
          {%- if product.compare_at_price > product.price -%}
            <span style="text-decoration: line-through; opacity: 0.5; font-size: 1.5rem; margin-left: 1rem; color: rgba(255,255,255,0.6);">
              {{ product.compare_at_price | money }}
            </span>
          {%- endif -%}
        </div>

        {% form 'product', product %}
          {%- if product.variants.size > 1 -%}
            <div style="margin-bottom: 2rem;">
              <label style="display: block; margin-bottom: 0.8rem; font-weight: 500;">Select Variant</label>
              <select
                name="id"
                style="
                  width: 100%;
                  padding: 1rem 1.5rem;
                  background-color: rgba(255, 255, 255, 0.08);
                  border: 1px solid rgba(255, 255, 255, 0.2);
                  border-radius: 6px;
                  color: #FFFFFF;
                  font-size: 1rem;
                "
              >
                {%- for variant in product.variants -%}
                  <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %}>
                    {{ variant.title }} - {{ variant.price | money }}
                    {%- unless variant.available %} (Sold Out){% endunless -%}
                  </option>
                {%- endfor -%}
              </select>
            </div>
          {%- else -%}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {%- endif -%}

          <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
            <button
              type="submit"
              class="product-add-to-cart"
              {% unless product.available %}disabled{% endunless %}
            >
              {%- if product.available -%}
                ADD TO CART
              {%- else -%}
                SOLD OUT
              {%- endif -%}
            </button>

            <div style="display: flex; align-items: center; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; background: rgba(255,255,255,0.05);">
              <button type="button" onclick="decrementQty()" style="padding: 0 1.25rem; height: 56px; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; border-right: 1px solid rgba(255,255,255,0.2);">−</button>
              <input
                type="number"
                name="quantity"
                value="1"
                min="1"
                id="product-qty"
                style="width: 70px; height: 56px; background: none; border: none; color: #FFFFFF; text-align: center; font-size: 1.1rem; font-weight: 500;"
                readonly
              >
              <button type="button" onclick="incrementQty()" style="padding: 0 1.25rem; height: 56px; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; border-left: 1px solid rgba(255,255,255,0.2);">+</button>
            </div>
          </div>
        {% endform %}

        {%- if product.description != blank -%}
          <div style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
            <h4 style="font-size: 0.85rem; font-weight: 600; margin-bottom: 1rem; letter-spacing: 0.08em; text-transform: uppercase;">Description</h4>
            <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem; line-height: 1.7; font-weight: 300;">
              {{ product.description }}
            </div>
          </div>
        {%- endif -%}

        <div style="border-top: 1px solid rgba(255,255,255,0.15); padding-top: 2rem;">
          <h3 style="font-size: 1.5rem; margin-bottom: 1.5rem;">Customer Reviews</h3>
          <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
            <div style="display: flex; gap: 0.25rem;">
              <span style="color: #FFC107; font-size: 1.1rem;">★</span>
              <span style="color: #FFC107; font-size: 1.1rem;">★</span>
              <span style="color: #FFC107; font-size: 1.1rem;">★</span>
              <span style="color: #FFC107; font-size: 1.1rem;">★</span>
              <span style="color: #FFC107; font-size: 1.1rem;">★</span>
            </div>
          </div>
          <div style="display: flex; align-items: start; gap: 1rem; padding: 1.5rem; background: rgba(255,255,255,0.05); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.15); flex-shrink: 0;"></div>
            <div>
              <p style="color: rgba(255,255,255,0.9); line-height: 1.6; margin: 0;">
                Great product! Highly recommend for anyone looking for quality gear.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    {%- if product.collections.size > 0 -%}
      {%- assign related_collection = product.collections.first -%}
      <div style="margin-top: 6rem;">
        <h2 class="section-title">Related Products</h2>
        <div class="product-grid">
          {%- for related_product in related_collection.products limit: 4 -%}
            {%- unless related_product.id == product.id -%}
              <a href="{{ related_product.url }}" class="product-card">
                <div class="product-image-wrapper">
                  {%- if related_product.featured_image != blank -%}
                    <img
                      src="{{ related_product.featured_image | image_url: width: 600 }}"
                      alt="{{ related_product.title }}"
                      class="product-image"
                      loading="lazy"
                    >
                  {%- endif -%}
                </div>
                <div class="product-info">
                  <h3 class="product-title">{{ related_product.title }}</h3>
                  <p class="product-price">{{ related_product.price | money }}</p>
                </div>
              </a>
            {%- endunless -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  @media screen and (max-width: 989px) {
    .container > div:first-child {
      grid-template-columns: 1fr !important;
    }
  }

  .product-thumbnail:hover {
    border-color: rgba(255,255,255,0.4) !important;
  }

  .product-thumbnail.active {
    border-color: var(--color-white) !important;
  }

  .product-add-to-cart {
    flex: 1;
    padding: 1rem 2rem;
    background: #4ECDC4;
    color: #1a1a1a;
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    letter-spacing: 0.5px;
  }

  .product-add-to-cart:hover:not(:disabled) {
    background: #45b8af;
    transform: translateY(-1px);
  }

  .product-add-to-cart:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>

<script>
  function selectImage(thumbnail, imageUrl) {
    const mainImage = document.getElementById('main-product-image');
    mainImage.src = imageUrl;
    document.querySelectorAll('.product-thumbnail').forEach(t => t.classList.remove('active'));
    thumbnail.classList.add('active');
  }

  document.addEventListener('DOMContentLoaded', () => {
    const thumbnails = document.querySelectorAll('.product-thumbnail');
    if (thumbnails.length > 0) {
      thumbnails[0].classList.add('active');

      thumbnails.forEach(thumb => {
        thumb.addEventListener('click', function() {
          const imageUrl = this.getAttribute('data-image-url');
          selectImage(this, imageUrl);
        });
      });
    }
  });

  function incrementQty() {
    const input = document.getElementById('product-qty');
    input.value = parseInt(input.value) + 1;
  }

  function decrementQty() {
    const input = document.getElementById('product-qty');
    if (parseInt(input.value) > 1) {
      input.value = parseInt(input.value) - 1;
    }
  }
</script>
